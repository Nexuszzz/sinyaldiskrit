<!DOCTYPE html>
<html>
<head>
    <title>Debug Signal Test</title>
    <script type="module">
        // Fungsi dari aplikasi
        function u(n) { return n >= 0 ? 1 : 0; }
        
        // Signal: (-n) * (u(n+2) - u(n)) + (n-1) * (u(n) - u(n-4))
        function x(n) {
            const part1 = (-n) * (u(n+2) - u(n));
            const part2 = (n-1) * (u(n) - u(n-4));
            return part1 + part2;
        }
        
        // Generate samples
        function generateSamples(nMin, nMax) {
            const samples = [];
            for (let n = nMin; n <= nMax; n++) {
                samples.push({ n, value: x(n) });
            }
            return samples;
        }
        
        // Get value at index
        function getValueAt(samples, n) {
            const sample = samples.find(s => s.n === n);
            return sample ? sample.value : 0;
        }
        
        // Apply compose operation
        function applyCompose(samples, expression, nMin, nMax) {
            const output = [];
            for (let n = nMin; n <= nMax; n++) {
                // Parse expression -n-2 manually
                const m = -n - 2;  // For expression "-n-2"
                const value = getValueAt(samples, m);
                output.push({ n, value });
            }
            return output;
        }
        
        // Test
        console.log("=== INPUT SIGNAL x(n) with range -15 to 15 ===");
        const inputSamples = generateSamples(-15, 15);
        inputSamples.filter(s => s.value !== 0).forEach(s => {
            console.log(`x(${s.n}) = ${s.value}`);
        });
        
        console.log("\n=== OUTPUT y(n) = x(-n-2) with range -5 to 2 ===");
        const outputSamples = applyCompose(inputSamples, "-n-2", -5, 2);
        outputSamples.forEach(s => {
            const m = -s.n - 2;
            console.log(`y(${s.n}) = x(${m}) = ${s.value}`);
        });
        
        // Display in page
        let html = "<h2>INPUT x(n) [non-zero values]</h2><table border='1'><tr><th>n</th><th>x(n)</th></tr>";
        inputSamples.filter(s => s.value !== 0).forEach(s => {
            html += `<tr><td>${s.n}</td><td>${s.value}</td></tr>`;
        });
        html += "</table>";
        
        html += "<h2>OUTPUT y(n) = x(-n-2)</h2><table border='1'><tr><th>n</th><th>m=-n-2</th><th>y(n)=x(m)</th></tr>";
        outputSamples.forEach(s => {
            const m = -s.n - 2;
            html += `<tr><td>${s.n}</td><td>${m}</td><td>${s.value}</td></tr>`;
        });
        html += "</table>";
        
        html += "<h2>EXPECTED (from handout)</h2><table border='1'><tr><th>n</th><th>Expected</th><th>Calculated</th><th>Match?</th></tr>";
        const expected = {[-5]: 2, [-4]: 1, [-3]: 0, [-2]: -1, [-1]: 1, [0]: 2, [1]: 0, [2]: 0};
        for (let n = -5; n <= 2; n++) {
            const calc = outputSamples.find(s => s.n === n)?.value;
            const exp = expected[n];
            const match = calc === exp ? "✓" : "✗";
            html += `<tr><td>${n}</td><td>${exp}</td><td>${calc}</td><td>${match}</td></tr>`;
        }
        html += "</table>";
        
        document.getElementById("output").innerHTML = html;
    </script>
</head>
<body>
    <h1>Signal Debug Test</h1>
    <div id="output">Loading...</div>
</body>
</html>
